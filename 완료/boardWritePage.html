<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>상담글 작성</title>
  <style>
  @font-face{font-family:'Gooorm Sans';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2304-2@1.0/gooorm-sans-400.woff2') format('woff2');font-weight:400;font-style:normal;font-display:swap}
  @font-face{font-family:'Gooorm Sans';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2304-2@1.0/gooorm-sans-500.woff2') format('woff2');font-weight:500;font-style:normal;font-display:swap}
  @font-face{font-family:'Gooorm Sans';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2304-2@1.0/gooorm-sans-700.woff2') format('woff2');font-weight:700;font-style:normal;font-display:swap}

  :root{
    --navy:#000777; --navy-700:#001366;
    --ink:#0f172a; --muted:#667085;
    --paper:#ffffff; --back:#f3f5ff;
    --line:#e2e6ff; --soft:#eef2ff;
    --shadow:0 2px 8px rgba(0,0,0,.04);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{ margin:0; background:var(--paper); color:var(--ink);
        font-family:"Gooorm Sans","Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,sans-serif; }

  /* Page */
  .page-write{ padding:20px 0 60px }
  .wrap{ width:min(1120px,94%); margin:0 auto }
  .backdrop{ background:var(--back); border:1px solid var(--line); border-radius:16px; padding:14px }

  /* Card */
  .card{ background:#fff; border:1px solid var(--line); border-radius:12px; box-shadow:var(--shadow); overflow:hidden }
  .inner{ padding:22px }

  /* Header row */
  .row{ display:grid; grid-template-columns:110px 1fr; gap:14px; align-items:center; padding:10px 0; border-top:1px solid var(--line) }
  .row:first-child{ border-top:none }
  .label{ font-weight:700; color:#1f2937; white-space:nowrap }
  .input,.textarea{ width:100%; height:34px; padding:0 12px; border:1.6px solid var(--line); border-radius:10px; outline:none; background:#fff }
  .textarea{ height:auto; min-height:320px; padding:12px; line-height:1.8; resize:none } /* ← resize 막음 */

  /* Chips */
  .chips{ display:flex; flex-wrap:wrap; gap:8px }
  .chip{ background:#fff; border:1px solid var(--line); border-radius:6px; padding:6px 12px; font-size:12px; display:inline-flex; align-items:center; gap:6px; height:34px; white-space:nowrap }
  .chip input{ margin:0 }
  .chip.active{ border-color:var(--navy); box-shadow:0 0 0 3px rgba(0,7,119,0.1) }

  /* Upload area */
  .upload-row{ display:grid; grid-template-columns:1fr 120px; gap:12px; align-items:start }
  .uploads{ display:flex; gap:12px; flex-wrap:wrap }
  .drop{ width:140px; height:100px; border:1.6px dashed var(--line); border-radius:10px; background:#fff; display:flex; align-items:center; justify-content:center; font-size:12px; color:#6b7280; cursor:pointer; user-select:none }
  .thumbs{ display:flex; gap:12px; flex-wrap:wrap; align-items:start }
  .thumb{ position:relative; width:140px; height:100px; border:1px solid var(--line); border-radius:10px; overflow:hidden; background:#fff; box-shadow:var(--shadow) }
  .thumb img{ width:100%; height:100%; object-fit:cover; display:block }
  .remove{ position:absolute; top:6px; right:6px; width:24px; height:24px; border-radius:6px; border:1px solid var(--line); background:#fff; font-weight:700; line-height:22px; text-align:center; cursor:pointer }
  .counter{ font-size:12px; color:var(--muted); margin-top:6px }

  .upload-btn{ height:34px; padding:0 14px; border-radius:10px; background:var(--navy); color:#fff; border:1px solid var(--navy); font-weight:700; cursor:pointer }
  .upload-btn:hover{ background:var(--navy-700); border-color:var(--navy-700) }

  /* Actions */
  .actions{ display:flex; justify-content:flex-end; gap:8px; padding:16px 22px; border-top:1px solid var(--line); background:#fff }
  .btn{ height:34px; padding:0 14px; border-radius:10px; background:var(--navy); color:#fff; border:1px solid var(--navy); font-weight:700; cursor:pointer }
  .btn:hover{ background:var(--navy-700); border-color:var(--navy-700) }
  .btn.ghost{ background:#fff; color:#111; border:1px solid var(--line) }
  .btn:disabled{ opacity:.6; cursor:not-allowed }

  /* Title */
  h1.title{ font-size:20px; font-weight:700; margin:0 0 12px }

  @media (max-width:760px){
    .row{ grid-template-columns:1fr }  }
  </style>
</head>
<body>
<main class="page-boardWrite">
  <div class="wrap">
    <div class="backdrop">
      <form class="card" id="writeForm">
        <div class="inner">
          <h1 class="title">상담글 작성</h1>

          <div class="row">
            <label for="title" class="label">제목</label>
            <input id="title" class="input" type="text" placeholder="예) 음주운전으로 사고를 냈..." minlength="2" required>
          </div>

          <div class="row">
            <span class="label">카테고리</span>
            <div class="chips" id="chips">
              <label class="chip"><input type="checkbox" value="교통사고 · 범죄"> 교통사고 · 범죄</label>
              <label class="chip"><input type="checkbox" value="재산범죄"> 재산범죄</label>
              <label class="chip"><input type="checkbox" value="폭행 · 협박"> 폭행 · 협박</label>
              <label class="chip"><input type="checkbox" value="명예훼손 · 모욕"> 명예훼손 · 모욕</label>
              <label class="chip"><input type="checkbox" value="부동산 · 임대차"> 부동산 · 임대차</label>
              <label class="chip"><input type="checkbox" value="금전 · 계약 문제"> 금전 · 계약 문제</label>
              <label class="chip"><input type="checkbox" value="가족"> 가족</label>
              <label class="chip"><input type="checkbox" value="회사"> 회사</label>
            </div>
          </div>

          <div class="row" style="align-items:start">
            <label for="content" class="label">내용</label>
            <textarea id="content" class="textarea" placeholder="00월 00일 운전하다가 어쩌구 저쩌구..." minlength="20" required></textarea>
          </div>

          <div class="row" style="align-items:start">
            <span class="label">첨부</span>
            <div class="upload-row">
              <div>
                <div class="uploads">
                  <div class="drop" id="drop">이미지 끌어다 놓기 / 클릭</div>
                  <div class="thumbs" id="thumbs"></div>
                </div>
                <div class="counter"><span id="count">0</span> / <span id="max">10</span>장</div>
                <input id="file" type="file" accept="image/*" hidden multiple>
              </div>
              <button type="button" class="upload-btn" id="uploadBtn">업로드</button>
            </div>
          </div>
        </div>

        <div class="actions">
          <button type="button" class="btn ghost" id="cancelBtn">취소</button>
          <button type="submit" class="btn" id="submitBtn" disabled>작성완료</button>
        </div>
      </form>
    </div>
  </div>
</main>

<script>
(function(){
  const MAX_FILES = 10;

  const form = document.getElementById('writeForm');
  const title = document.getElementById('title');
  const content = document.getElementById('content');
  const submitBtn = document.getElementById('submitBtn');

  const uploadBtn = document.getElementById('uploadBtn');
  const drop = document.getElementById('drop');
  const fileInput = document.getElementById('file');
  const thumbs = document.getElementById('thumbs');
  const count = document.getElementById('count');
  const maxSpan = document.getElementById('max');

  maxSpan.textContent = MAX_FILES;

  function validate(){
    const ok = title.value.trim().length >= 2 && content.value.trim().length >= 20;
    submitBtn.disabled = !ok;
  }
  title.addEventListener('input', validate);
  content.addEventListener('input', validate);
  content.addEventListener('keydown', (e)=>{
    if((e.ctrlKey||e.metaKey)&&e.key==='Enter'){
      if(!submitBtn.disabled) form.requestSubmit();
    }
  });

  // Chips UI
  document.getElementById('chips').addEventListener('change', (e)=>{
    if(e.target && e.target.type === 'checkbox'){
      e.target.closest('.chip').classList.toggle('active', e.target.checked);
    }
  });

  function updateCounter(){
    count.textContent = thumbs.querySelectorAll('.thumb').length;
  }

  function createThumb(dataURL){
    const div = document.createElement('div');
    div.className = 'thumb';
    div.innerHTML = '<img alt="업로드 이미지"><button type="button" class="remove" aria-label="삭제">×</button>';
    div.querySelector('img').src = dataURL;
    div.querySelector('.remove').addEventListener('click', ()=>{
      div.remove();
      updateCounter();
    });
    thumbs.appendChild(div);
    updateCounter();
  }

  function addFiles(files){
    const already = thumbs.querySelectorAll('.thumb').length;
    const remain = MAX_FILES - already;
    if(remain <= 0){ alert('이미지는 최대 ' + MAX_FILES + '장까지 가능합니다.'); return; }
    const list = Array.from(files).slice(0, remain);
    list.forEach(file=>{
      if(!file.type.startsWith('image/')) return;
      const reader = new FileReader();
      reader.onload = e => createThumb(e.target.result);
      reader.readAsDataURL(file);
    });
    if(files.length > remain){
      alert('최대 ' + MAX_FILES + '장까지만 추가됩니다.');
    }
  }

  function openPicker(){ fileInput.click(); }
  uploadBtn.addEventListener('click', openPicker);
  drop.addEventListener('click', openPicker);

  fileInput.addEventListener('change', (e)=> addFiles(e.target.files));

  // Drag & Drop support
  ;['dragenter','dragover'].forEach(evt=>{
    drop.addEventListener(evt, e=>{ e.preventDefault(); e.stopPropagation(); drop.style.borderColor = '#94a3b8'; });
  });
  ;['dragleave','drop'].forEach(evt=>{
    drop.addEventListener(evt, e=>{ e.preventDefault(); e.stopPropagation(); drop.style.borderColor = 'var(--line)'; });
  });
  drop.addEventListener('drop', e=>{
    const files = e.dataTransfer.files;
    addFiles(files);
  });

  document.getElementById('cancelBtn').addEventListener('click', ()=>{
    if(confirm('작성한 내용을 모두 지울까요?')){
      form.reset();
      thumbs.innerHTML = '';
      updateCounter();
      document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
      validate();
    }
  });

  form.addEventListener('submit', (e)=>{
    e.preventDefault();
    alert('작성 완료되었습니다. (데모)');
  });

  validate();
  updateCounter();
})();
</script>
</body>
</html>
